const fmt=new Intl.NumberFormat('ar-EG',{style:'currency',currency:'EGP'});const e={grid:document.getElementById('grid'),count:document.getElementById('count'),search:document.getElementById('search'),brand:document.getElementById('brand'),minPrice:document.getElementById('minPrice'),maxPrice:document.getElementById('maxPrice'),clear:document.getElementById('clear')};let a=[],l=[];async function load(){const t=await fetch('data/products.json?_='+Date.now());a=await t.json();const n=[...new Set(a.map(p=>p.brand).filter(Boolean))].sort();e.brand.innerHTML='<option value="">All brands</option>'+n.map(b=>`<option>${b}</option>`).join('');applyFilters()}function applyFilters(){const t=(e.search.value||'').toLowerCase(),n=e.brand.value||'',r=parseFloat(e.minPrice.value),o=parseFloat(e.maxPrice.value);l=a.filter(p=>{const s=!t||p.name.toLowerCase().includes(t),i=!n||p.brand===n,c=p.price_egp||0,d=isNaN(r)||c>=r,u=isNaN(o)||c<=o;return s&&i&&d&&u});render()}function render(){e.count.textContent=`${l.length} products`;e.grid.innerHTML=l.map(p=>`<article class='card'><img src='${p.image_url||''}' alt='${p.name}' loading='lazy'/><div class='body'><h3>${p.name}</h3><div class='price'>${fmt.format(p.price_egp||0)}</div><div class='meta'>${p.brand||''} • ${p.category||''} • <span>${p.source||''}</span></div><a class='btn' href='${p.url}' target='_blank' rel='noopener'>View</a></div></article>`).join('')}['input','change'].forEach(t=>{e.search.addEventListener(t,applyFilters);e.brand.addEventListener(t,applyFilters);e.minPrice.addEventListener(t,applyFilters);e.maxPrice.addEventListener(t,applyFilters)});e.clear.addEventListener('click',()=>{e.search.value='';e.brand.value='';e.minPrice.value='';e.maxPrice.value='';applyFilters()});load()